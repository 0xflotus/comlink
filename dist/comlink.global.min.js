"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),self.Comlink=function(){function a(b){return b instanceof MessagePort&&b.start(),g(async(c,d,f)=>{const g=await e(b,{type:c,callPath:d,argumentsList:f},j(f)),h=g.data;return"PROXY"===h.type?a(h.endpoint):h.obj})}function b(a){return a[p]=!0,a}function c(a,e){e instanceof MessagePort&&e.start(),e.addEventListener("message",async function(f){const g=f.data;let h=await g.callPath.reduce((a,b)=>a[b],a);switch(g.type){case"APPLY":{g.callPath.pop();const c=await g.callPath.reduce((a,b)=>a[b],a),d="AsyncGeneratorFunction"===h.constructor.name;h=await h.apply(c,g.argumentsList),d&&(h=b(h))}case"GET":{const a=l(h);return a.id=g.id,d(e,a,j(h))}case"CONSTRUCT":{const a=new h(...(g.argumentsList||[])),{port1:b,port2:f}=new MessageChannel;return c(a,b),d(e,{id:g.id,type:"PROXY",endpoint:f},[f])}}})}function d(a,b,c){return a instanceof Window?a.postMessage(b,"*",c):a.postMessage(b,c)}function e(a,b,c){const e=`${m}-${n++}`;return new Promise((f)=>{a.addEventListener("message",function b(c){c.data.id!==e||(a.removeEventListener("message",b),f(c))}),b=Object.assign({},b,{id:e}),d(a,b,c)})}function f(){return"asyncIterator"in Symbol}function g(a){let b=[];return new Proxy(function(){},{construct(c,d){const e=a("CONSTRUCT",b,d);return b=[],e},apply(c,d,e){if("bind"===b[b.length-1]){const c=b.slice();return b=[],(...b)=>a("APPLY",c.slice(0,-1),b)}const f=a("APPLY",b,e);return b=[],f},get(c,d,e){if("then"===d&&0===b.length)return{then:()=>e};if(f()&&d===Symbol.asyncIterator)return()=>e;if("then"===d){const c=a("GET",b);return b=[],Promise.resolve(c).then.bind(c)}return b.push(d),e}})}function h(a){return o.some((b)=>a instanceof b)}function*i(a){if(!a)return;if("string"==typeof a)return;yield a;let b=Object.values(a);Array.isArray(a)&&(b=a);for(const c of b)yield*i(c)}function j(a){const b=[];for(const c of i(a))h(c)&&b.push(c);return b}function k(a){return a&&a[p]}function l(a){if(k(a)){const{port1:b,port2:d}=new MessageChannel;return c(a,b),{type:"PROXY",endpoint:d}}return{type:"OBJECT",obj:a}}const m=Math.floor(Math.random()*Number.MAX_SAFE_INTEGER);let n=0;const o=[ArrayBuffer,MessagePort],p=Symbol("transferProxy");return{proxy:a,transferProxy:b,expose:c}}();
