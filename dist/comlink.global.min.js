"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),self.Comlink=function(){function a(a,b,c){return a instanceof Window?a.postMessage(b,"*",c):a.postMessage(b,c)}function b(b,c,d){const e=`${m}-${n++}`;return new Promise((f)=>{b.addEventListener("message",function a(c){c.data.id!==e||(b.removeEventListener("message",a),f(c))}),c=Object.assign({},c,{id:e}),a(b,c,d)})}function c(){return"asyncIterator"in Symbol}function d(a){let b=[];return new Proxy(function(){},{construct(c,d){const e=a("CONSTRUCT",b,d);return b=[],e},apply(c,d,e){if("bind"===b[b.length-1]){const c=b.slice();return b=[],(...b)=>a("APPLY",c.slice(0,-1),b)}const f=a("APPLY",b,e);return b=[],f},get(d,e,f){if("then"===e&&0===b.length)return{then:()=>f};if(c()&&e===Symbol.asyncIterator)return()=>f;if("then"===e){const c=a("GET",b);return b=[],Promise.resolve(c).then.bind(c)}return b.push(e),f}})}function e(a){return o.some((b)=>a instanceof b)}function*f(a){if(!a)return;if("string"==typeof a)return;yield a;let b=Object.values(a);Array.isArray(a)&&(b=a);for(const c of b)yield*f(c)}function g(a){return Array.from(f(a)).filter((a)=>e(a))}function h(a){return a instanceof MessagePort&&a.start(),d(async(c,d,e)=>{const f=await b(a,{type:c,callPath:d,argumentsList:e},g(e)),i=f.data;return"PROXY"===i.type?h(i.endpoint):i.obj})}function i(a){return a[p]=!0,a}function j(a){return a&&a[p]}function k(a){if(j(a)){const{port1:b,port2:c}=new MessageChannel;return l(a,b),{type:"PROXY",endpoint:c}}return{type:"OBJECT",obj:a}}function l(b,c){c instanceof MessagePort&&c.start(),c.addEventListener("message",async function(d){const e=d.data;switch(e.type){case"GET":case"APPLY":{let d=await e.callPath.reduce((a,b)=>a[b],b);if("APPLY"===e.type){e.callPath.pop();const a=await e.callPath.reduce((a,b)=>a[b],b),c="AsyncGeneratorFunction"===d.constructor.name;d=await d.apply(a,e.argumentsList),c&&(d=i(d))}const f=k(d);f.id=e.id,a(c,f,g(d));break}case"CONSTRUCT":{const d=e.callPath.reduce((a,b)=>a[b],b),f=new d(...(e.argumentsList||[])),{port1:g,port2:h}=new MessageChannel;l(f,g),a(c,{id:e.id,type:"PROXY",endpoint:h},[h]);break}}})}const m=Math.floor(Math.random()*Number.MAX_SAFE_INTEGER);let n=0;const o=[ArrayBuffer,MessagePort],p=Symbol("transferProxy");return{proxy:h,transferProxy:i,expose:l}}();
